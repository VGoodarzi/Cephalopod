@page "/login"


@if (SignInMethod == SignInMethodType.Otp)
{
    <SendOtp OnSignInSucceeded="OnSignInSucceeded"
             SignInMethodChanged="SignInMethodChanged" />
}
else
{
    <SignInWithPassword OnSignInSucceeded="OnSignInSucceeded"
                        SignInMethodChanged="SignInMethodChanged" />
}

@code {
    [SupplyParameterFromQuery]
    private string? ReturnUrl { get; init; }

    private SignInMethodType SignInMethod { get; set; }

    void SignInMethodChanged(SignInMethodType signInMethod)
    {
        SignInMethod = signInMethod;
    }

    async Task OnSignInSucceeded(SignInResponse response)
    {
        await CacheService.Set(BlazorConstants.AccessTokenCookieName, response.AccessToken);
        await CacheService.Set(BlazorConstants.RefreshTokenCookieName, response.RefreshToken);
        await AuthenticationNotify.LoggedIn(response.ExpiredAt);

        NavigationManager.NavigateTo(ReturnUrl ?? "/");
    }

    public enum SignInMethodType
    {
        Password = 1,
        Otp = 2
    }
}