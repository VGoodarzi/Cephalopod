@page "/forgot-password"

@if (_signInResponse is null)
{
    <SendOtp OnSignInSucceeded="OnSignInSucceeded"
             SignInMethodChanged="(_) => SignInMethodChanged()" />
}
else
{
    <SetPassword TemporaryAccessToken="@_signInResponse.Value.AccessToken"
                 PasswordHasChanged="OnPassWordChanged" />
}


@code {
    private SignInResponse? _signInResponse = null!;

    private void SignInMethodChanged()
    {
        NavigationManager.NavigateTo("/login");
    }

    async Task OnPassWordChanged()
    {
        if(_signInResponse is null)
            return;

        await CacheService.Set(BlazorConstants.AccessTokenCookieName, _signInResponse.Value.AccessToken);
        await CacheService.Set(BlazorConstants.RefreshTokenCookieName, _signInResponse.Value.RefreshToken);
        await AuthenticationNotify.LoggedIn(_signInResponse.Value.ExpiredAt);
    }

    Task OnSignInSucceeded(SignInResponse response)
    {
        _signInResponse = response;
        return Task.CompletedTask;
    }
}
